<script src="http://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>


<table class="table-striped table-bordered table" >
<tr>
    <th>Report Title</th>
    <th colspan=2>Actions</th>
</tr>
<tr>
    <th><%= link_to @report.title, report_path(@report, @image), :title => 'edit report attributes'  %></th>
    <th>  
        <%= link_to 'synchronize', synchronize_report_path(@report), :title => 'synchronzie report data', :method => :POST, :id => 'synchronize'  %>
    </th>
    <% if @image.nil? %>
	    <td>no data found</td>
    <% else %>
	    <th><%= link_to 'log', stat_report_image_path(@report, @image), :title => 'see log data'  %></th>
    <% end %>
</td>
</tr>
</table>


<table class="table-bordered table sortable">

    <% if @data.size > 0 %>
        <tr>
            <th> host / metric</th>
        <% @data.first[:data].map { |i| i[0].metric }.each do |m| %>
            <th><%= m.title %></th>
        <% end %>
        </tr>
    <% end %>

    <% @data.each do |row| %>
        <tr>

           <th width="100"><%= row[:fqdn] %></th>
           <% row[:data].each do |i| %>
                <% age = time_ago_in_words(Time.at(i[0][:timestamp])) %>
                <% stat = i[0]; title = i[1]; css_class = i[2]; %>
                <td title="<%= title %> updated: <%= age %> ago." class="<%= css_class %>">
                    <pre title="<%= title %> updated: <%= age %> ago."><%= (stat.value||"").force_encoding('UTF-8') %></pre>
                </td>
           <% end %>
        </tr> 
   <% end %>
</table>


<!--

mysql> desc stats;
+------------+--------------+------+-----+---------+----------------+
| Field      | Type         | Null | Key | Default | Extra          |
+------------+--------------+------+-----+---------+----------------+
| id         | int(11)      | NO   | PRI | NULL    | auto_increment |
| value      | mediumblob   | YES  |     | NULL    |                |
| metric_id  | int(11)      | YES  | MUL | NULL    |                |
| timestamp  | int(11)      | YES  |     | NULL    |                |
| host_id    | int(11)      | YES  |     | NULL    |                |
| created_at | datetime     | YES  |     | NULL    |                |
| updated_at | datetime     | YES  |     | NULL    |                |
| task_id    | int(11)      | YES  | MUL | NULL    |                |
| image_id   | int(11)      | YES  | MUL | NULL    |                |
| status     | varchar(255) | YES  |     | PENDING |                |
| deviated   | tinyint(1)   | YES  |     | 0       |                |
| duration   | int(11)      | YES  |     | NULL    |                |
+------------+--------------+------+-----+---------+----------------+
12 rows in set (0.00 sec)

-->
