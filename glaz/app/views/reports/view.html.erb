<table class="table-striped table-bordered table">
<tr>
    <th>Report Title</th>
    <th>Report Tag ID</th>
</tr>
<tr>
    <td><strong><%= @report.title %></strong></td>
    <td><strong><%= @tag_id %></strong></td>
</td>
</tr>
</table>

<table class="table-striped table-bordered table">
<tr>
    <th colspan=3 >Actions</th>
</tr>
<tr>
    <td>
        <%= link_to 'edit', report_path(@report), :title => 'edit report attributes'  %>
    </td>
    <td>
        <%= link_to 'synchronize', synchronize_report_path(@report), :title => 'synchronzie report data', :method => :POST, :id => 'synchronize'  %>
    </td>
    <td>
        <% if @tag_id.nil? %>
            <%= link_to 'archive', tag_report_path(@report), :title => 'archive current report', :method => :POST  %>
        <% end %>
    </td>
</td>
</tr>
</table>

<table class="table-striped table-bordered table">
<tr>
    <th>Avalable Reports</th>
</tr>
<%- if @report.has_tags? %>
<tr>
    <th>
        ID / Date
    </th>
<tr>
<tr>
    <td>
            <%= form_for :report, url: view_report_path(@report), :method => :GET  do |f| %>
                <%= select_tag :tag_id, options_for_select([['Latest', nil]] + @report.tags.reverse.map {|i| a= []; a[0] = 'ID:' + "#{i.id}" + ' |  ' + i.created_at.strftime('%a, %B %d at %H:%M'); a[1]= i.id;  a   }, :selected => @tag_id ), {}  %>
                <%= f.submit :value => 'view' %>
            <% end %>
    </td>
</tr>
<% else %>
<tr>
    <td> 0 archived reports found </td>
</tr>
<% end %>
</table>

<table class="table-striped table-bordered table">
<tr>
    <th>Metric/Host</th>
<% @hosts.each do |i| %>
        <td>
            <strong class="text-info"><%= link_to  i.fqdn, host_path(i), :title => i.title  %></strong>
            <sub><%= link_to  'sync', synchronize_host_path(i), :method => :POST, :title => 'request synchronization'  %></sub>
        </td>
<% end %>
</tr>

<% @metrics.each do |m| %>
<tr>
    <th class="text-info" title="<%= m.title %>" >
        <%= link_to m.name||m.title, metric_path(m), :title => m.title %>
    </th>
    <% @hosts.each do |h| %>
            <% status = h.metric_status(m, @tag_id);  %> 
            <% status_desc = h.metric_status_as_text(m, @tag_id);  %> 
            <th><table><tr><td bgcolor="<%=  h.metric_status_as_color(m, @tag_id)  %>" width="10" height="10" title="status: <%= status_desc  %>"></td></tr></table>
                <% if status == -1 %>
                    <span title="status: <%= status_desc  %>">?!</span>
                <% elsif status == -2 %>
                   <small class="text-mute"><%= link_to h.metric_build(m, @tag_id).id, task_build_path( h.metric_task(m, @tag_id), h.metric_build(m, @tag_id) ), :title => 'see log data'    %></small>
                    <pre  title="status: <%= status_desc  %>. default value: <%= m.default_value %>. last update: <%=  time_ago_in_words(h.metric_timestamp(m, @tag_id)) %> ago" ><%= h.metric_value(m, @tag_id) %></pre>
                <% elsif status == -3 %>
                    <span title="status: <%= status_desc  %>">?</span>
                <% elsif status == -4 %>
                    <small class="text-mute"><%= link_to h.metric_build(m, @tag_id).id, task_build_path( h.metric_task(m, @tag_id), h.metric_build(m, @tag_id) ), :title => 'see log data'    %></small>
                    <pre  title="status: <%= status_desc  %>. last update: <%=  time_ago_in_words(h.metric_timestamp(m, @tag_id)) %> ago" ><%= h.metric_value(m, @tag_id) %></pre>
                <% elsif status == 1 %>
                    <small class="text-mute"><%= link_to h.metric_build(m, @tag_id).id, task_build_path( h.metric_task(m, @tag_id), h.metric_build(m, @tag_id
) ), :title => 'see log data'    %></small>
                    <pre  title="status: <%= status_desc  %>. last update: <%=  time_ago_in_words(h.metric_timestamp(m, @tag_id)) %> ago" ><%= h.metric_value(m, @tag_id) %></pre>
                <% end %>
            </th>
    <% end %>
</tr>
<% end %>
</table>

